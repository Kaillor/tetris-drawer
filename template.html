<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        display: flex;
      }

      .matrix-container {
        margin: auto;
      }

      .matrix {
        border: 4px solid #cccccc;
      }

      .row {
        display: flex;
      }

      .tetrominos-container {
        margin: auto;
      }

      .tetrominos-row {
        display: flex;
        justify-content: space-evenly;
      }

      .tetromino {
        margin: 24px;
      }

      .tetromino-deselected {
        opacity: 50%;
      }
    </style>
  </head>
  <body>
    <div id="matrixContainer" class="matrix-container"></div>
    <div id="tetrominosContainer" class="tetrominos-container"></div>
    <script>
      // --------
      // SETTINGS
      // --------
      let svgNS = "http://www.w3.org/2000/svg";

      let cellSideLength = "48";
      let cellShadowWidth = "4";

      let cellShadowWidthHalf = cellShadowWidth / 2;
      let cellSideLenghtWithoutShadow = cellSideLength - cellShadowWidth;
      let cellSideLenghtWithoutHalfOfShadow =
        cellSideLength - cellShadowWidthHalf;
      let cellLightShadowPathDAttribute = [
        "M",
        cellSideLenghtWithoutShadow,
        cellShadowWidthHalf,
        "L",
        cellShadowWidthHalf,
        cellShadowWidthHalf,
        "L",
        cellShadowWidthHalf,
        cellSideLenghtWithoutShadow,
      ].join(" ");
      let cellDarkShadowPathDAttribute = [
        "M",
        cellSideLenghtWithoutHalfOfShadow,
        cellShadowWidth,
        "L",
        cellSideLenghtWithoutHalfOfShadow,
        cellSideLenghtWithoutHalfOfShadow,
        "L",
        cellShadowWidth,
        cellSideLenghtWithoutHalfOfShadow,
      ].join(" ");

      // -----
      // CELLS
      // -----
      function cellProperties(background, light, dark) {
        return {
          background: background,
          light: light,
          dark: dark,
        };
      }

      let _ = cellProperties("#ffffff", "#ffffff", "#eeeeee");
      let X = cellProperties("#c8c8c8", "#dcdcdc", "#b4b4b4");
      let I = cellProperties("#31c7ef", "#48e0ff", "#20b0e0");
      let O = cellProperties("#f7d308", "#ffec1c", "#e8c000");
      let T = cellProperties("#ad4d9c", "#c658b4", "#983888");
      let S = cellProperties("#42b642", "#48d048", "#30a030");
      let Z = cellProperties("#ef2029", "#ff4848", "#d01818");
      let J = cellProperties("#5a65ad", "#6680cc", "#4857a0");
      let L = cellProperties("#ef7921", "#ff9030", "#e06810");

      // ----------
      // TETROMINOS
      // ----------
      function tetrominoProperties(matrixProperties, selectionCellProperties) {
        return {
          matrixProperties: matrixProperties,
          selectionCellProperties: selectionCellProperties,
        };
      }

      let _Tetromino = tetrominoProperties(
        [
          [_, _, _, _],
          [_, _, _, _],
        ],
        _
      );
      let XTetromino = tetrominoProperties(
        [
          [X, X, X, X],
          [X, X, X, X],
        ],
        X
      );
      let ITetromino = tetrominoProperties(
        [
          [I, I, I, I],
          [_, _, _, _],
        ],
        I
      );
      let OTetromino = tetrominoProperties(
        [
          [_, O, O, _],
          [_, O, O, _],
        ],
        O
      );
      let TTetromino = tetrominoProperties(
        [
          [_, T, T, T],
          [_, _, T, _],
        ],
        T
      );
      let STetromino = tetrominoProperties(
        [
          [_, _, S, S],
          [_, S, S, _],
        ],
        S
      );
      let ZTetromino = tetrominoProperties(
        [
          [Z, Z, _, _],
          [_, Z, Z, _],
        ],
        Z
      );
      let JTetromino = tetrominoProperties(
        [
          [J, J, J, _],
          [_, _, J, _],
        ],
        J
      );
      let LTetromino = tetrominoProperties(
        [
          [_, L, L, L],
          [_, L, _, _],
        ],
        L
      );

      // -------------
      // ELEMENT UTILS
      // -------------
      function htmlElement(qualifiedName) {
        return document.createElement(qualifiedName);
      }

      function div() {
        return htmlElement("div");
      }

      function svgElement(qualifiedName) {
        return document.createElementNS(svgNS, qualifiedName);
      }

      function svg() {
        return svgElement("svg");
      }
      function rect() {
        return svgElement("rect");
      }
      function path() {
        return svgElement("path");
      }

      function setAttribute(element, qualifiedName, value) {
        element.setAttribute(qualifiedName, value);
      }

      function setId(element, id) {
        setAttribute(element, "id", id);
      }
      function setClass(element, cssClass) {
        setAttribute(element, "class", cssClass);
      }
      function addClass(element, cssClass) {
        element.classList.add(cssClass);
      }
      function removeClass(element, cssClass) {
        element.classList.remove(cssClass);
      }

      function setWidth(element, width) {
        setAttribute(element, "width", width);
      }
      function setHeight(element, height) {
        setAttribute(element, "height", height);
      }
      function setWidthAndHeight(element, value) {
        setWidth(element, value);
        setHeight(element, value);
      }

      function setFill(element, fill) {
        setAttribute(element, "fill", fill);
      }
      function setD(element, d) {
        setAttribute(element, "d", d);
      }
      function setStrokeWidth(element, strokeWidth) {
        setAttribute(element, "stroke-width", strokeWidth);
      }
      function setStroke(element, stroke) {
        setAttribute(element, "stroke", stroke);
      }

      function setData(element, qualifiedName, data) {
        setAttribute(element, `data-${qualifiedName}`, JSON.stringify(data));
      }
      function getData(element, qualifiedName) {
        return JSON.parse(element.getAttribute(`data-${qualifiedName}`));
      }

      function getFirstElementByClassNameOfElement(element, className) {
        return element.getElementsByClassName(className).item(0);
      }
      function getFirstElementByClassName(className) {
        return getFirstElementByClassNameOfElement(document, className);
      }

      // --------------------
      // EVENT HANDLERS UTILS
      // --------------------
      function deselectTetrominos() {
        let tetrominos = document.getElementsByClassName("tetromino");
        for (var i = 0; i < tetrominos.length; i++) {
          let tetromino = tetrominos[i];
          removeClass(tetromino, "tetromino-selected");
          addClass(tetromino, "tetromino-deselected");
        }
      }

      function selectTetromino(tetromino) {
        removeClass(tetromino, "tetromino-deselected");
        addClass(tetromino, "tetromino-selected");
      }

      function selectionCellProperties() {
        return getData(
          getFirstElementByClassName("tetromino-selected"),
          "selectionCellProperties"
        );
      }

      function updateCell(cell, cellProperties) {
        setFill(
          getFirstElementByClassNameOfElement(cell, "cell-background"),
          cellProperties.background
        );
        setStroke(
          getFirstElementByClassNameOfElement(cell, "cell-light-shadow"),
          cellProperties.light
        );
        setStroke(
          getFirstElementByClassNameOfElement(cell, "cell-dark-shadow"),
          cellProperties.dark
        );
      }

      function updateCellOfEventTarget(event) {
        let cell = event.target.parentNode;
        if (!cell.classList.contains("cell")) {
          return;
        }
        updateCell(cell, selectionCellProperties());
      }

      // --------------
      // EVENT HANDLERS
      // --------------
      function handleTetrominoClick(event) {
        deselectTetrominos();
        selectTetromino(event.currentTarget);
      }

      function handleMatrixMouseDown(event) {
        updateCellOfEventTarget(event);
      }

      function handleMatrixMouseMove(event) {
        updateCellOfEventTarget(event);
      }

      function handleDocumentMouseDown() {
        document
          .getElementById("matrix")
          .addEventListener("mousemove", handleMatrixMouseMove);
      }

      function handleDocumentMouseUp() {
        document
          .getElementById("matrix")
          .removeEventListener("mousemove", handleMatrixMouseMove);
      }

      // -----------
      // RENDER CELL
      // -----------
      function cellContainer() {
        let cellContainer = svg();
        setWidthAndHeight(cellContainer, cellSideLength);
        return cellContainer;
      }

      function cellBackground(cellProperties) {
        let cellBackground = rect();
        setClass(cellBackground, "cell-background");
        setWidthAndHeight(cellBackground, cellSideLength);
        setFill(cellBackground, cellProperties.background);
        return cellBackground;
      }

      function cellShadow(cssClass, pathDAttribute, stroke) {
        let cellShadow = path();
        setClass(cellShadow, cssClass);
        setFill(cellShadow, "none");
        setD(cellShadow, pathDAttribute);
        setStrokeWidth(cellShadow, cellShadowWidth);
        setStroke(cellShadow, stroke);
        return cellShadow;
      }

      function cellLightShadow(cellProperties) {
        return cellShadow(
          "cell-light-shadow",
          cellLightShadowPathDAttribute,
          cellProperties.light
        );
      }

      function cellDarkShadow(cellProperties) {
        return cellShadow(
          "cell-dark-shadow",
          cellDarkShadowPathDAttribute,
          cellProperties.dark
        );
      }

      function cell(cellProperties) {
        let cell = cellContainer();
        setClass(cell, "cell");
        cell.appendChild(cellBackground(cellProperties));
        cell.appendChild(cellLightShadow(cellProperties));
        cell.appendChild(cellDarkShadow(cellProperties));
        return cell;
      }

      // -------------
      // RENDER MATRIX
      // -------------
      function row(rowProperties) {
        let row = div();
        setClass(row, "row");
        rowProperties.forEach((cellProperties) => {
          row.appendChild(cell(cellProperties));
        });
        return row;
      }

      function matrix(matrixProperties) {
        let matrix = div();
        matrixProperties.forEach((rowProperties) => {
          matrix.appendChild(row(rowProperties));
        });
        return matrix;
      }

      function matrixElement(matrixProperties) {
        let matrixElement = matrix(
          Array.from({ length: 20 }, () => Array.from({ length: 10 }, () => _))
        );
        setId(matrixElement, "matrix");
        setClass(matrixElement, "matrix");
        matrixElement.addEventListener("mousedown", handleMatrixMouseDown);
        return matrixElement;
      }

      // -----------------
      // RENDER TETROMINOS
      // -----------------
      function tetromino(tetrominoProperty) {
        let tetromino = matrix(tetrominoProperty.matrixProperties);
        setClass(tetromino, "tetromino tetromino-deselected");
        setData(
          tetromino,
          "selectionCellProperties",
          tetrominoProperty.selectionCellProperties
        );
        tetromino.addEventListener("click", handleTetrominoClick);
        return tetromino;
      }

      function tetrominoRow(tetrominoRowProperties) {
        let tetrominoRow = div();
        setClass(tetrominoRow, "tetrominos-row");
        tetrominoRowProperties.forEach((tetrominoProperty) => {
          tetrominoRow.appendChild(tetromino(tetrominoProperty));
        });
        return tetrominoRow;
      }

      function tetrominoRows(tetrominoRowsProperties) {
        let tetrominoRows = div();
        tetrominoRowsProperties.forEach((tetrominoRowProperties) => {
          tetrominoRows.appendChild(tetrominoRow(tetrominoRowProperties));
        });
        return tetrominoRows;
      }

      function tetrominos() {
        return tetrominoRows([
          [ITetromino],
          [OTetromino, TTetromino],
          [STetromino, ZTetromino],
          [JTetromino, LTetromino],
          [_Tetromino, XTetromino],
        ]);
      }

      // ----------
      // RENDER DOM
      // ----------
      document.addEventListener("mousedown", handleDocumentMouseDown);
      document.addEventListener("mouseup", handleDocumentMouseUp);

      document.getElementById("matrixContainer").appendChild(matrixElement());
      document.getElementById("tetrominosContainer").appendChild(tetrominos());

      selectTetromino(getFirstElementByClassName("tetromino"));
    </script>
  </body>
</html>
